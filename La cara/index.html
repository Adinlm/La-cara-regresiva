<!DOCTYPE html>

<html lang="es">

<head>

       
    <meta charset="UTF-8">

       
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Contador Estelar v3 (Bootstrap)</title>

       
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

        <style>
        body {

            overflow: hidden;

        }



        #star-container {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            pointer-events: none;

            z-index: -1;

        }



        #timerDisplay {

            font-size: 2.8em;

            font-family: 'Courier New', Courier, monospace;

            min-width: 380px;

        }



        .face-container {

            /* Margin handled by Bootstrap my-4 */

        }



        .face {

            width: 100px;

            height: 100px;

            border: 5px solid hsl(var(--face-hue, 0), 90%, 60%);

            background-color: hsla(var(--face-hue, 0), 70%, 50%, 0.6);

            border-radius: 50%;

            position: relative;

            display: flex;

            align-items: center;

            justify-content: center;

            transition: border-color 0.8s ease, background-color 0.8s ease;

            --face-hue: 0;

            box-shadow: 0 0 15px hsla(var(--face-hue, 0), 80%, 60%, 0.5);

            /* Vibration animation will be applied dynamically */

        }



        /* Ojos */

        .face::before,

        .face::after {

            content: '';

            position: absolute;

            width: 12px;

            height: 12px;

            background-color: rgba(0, 0, 0, 0.8);

            border-radius: 50%;

            top: 30px;

        }

        .face::before {
            left: 25px;
        }

        .face::after {
            right: 25px;
        }



        /* Boca base */

        .mouth {

            width: 45px;

            border: 4px solid rgba(0, 0, 0, 0.8);

            position: absolute;

            left: 50%;

            transform: translateX(-50%);

            transition: all 0.5s ease;

        }



        .sad-mouth {
            height: 15px;
            border-radius: 50px 50px 0 0 / 30px 30px 0 0;
            border-bottom: none;
            border-top-width: 4px;
            bottom: 30px;
        }

        .happy-mouth {
            height: 20px;
            border-radius: 0 0 50px 50px / 0 0 30px 30px;
            border-top: none;
            border-bottom-width: 4px;
            bottom: 25px;
        }



        /* --- Vibration Animation --- */

        @keyframes vibrate {

            0%,
            100% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(-1px, 1px) rotate(-0.5deg);
            }

            50% {
                transform: translate(1px, -1px) rotate(0.5deg);
            }

            75% {
                transform: translate(1px, 1px) rotate(-0.5deg);
            }

        }



        .vibrating {

            animation-name: vibrate;

            animation-iteration-count: infinite;

            animation-timing-function: linear;

            /* animation-duration is set via JS */

        }





        /* Star Style - Keep As Is */

        .star {

            position: absolute;

            width: 2px;

            height: 2px;

            background-color: #ffffff;

            border-radius: 50%;

            box-shadow: 0 0 6px #ffffff;

            animation: twinkle 2.5s infinite alternate ease-in-out;

        }

        .star.medium {
            width: 3px;
            height: 3px;
            animation-duration: 3s;
        }

        .star.large {
            width: 4px;
            height: 4px;
            animation-duration: 2s;
            box-shadow: 0 0 8px #ffffff;
        }



        @keyframes twinkle {

            0% {
                opacity: 0.5;
                transform: scale(0.7);
            }

            100% {
                opacity: 1;
                transform: scale(1.0);
            }

        }



        .input-area label {

            margin-right: 0.5rem;

        }

        .input-area input[type="time"] {

            max-width: 150px;

        }
    </style>

</head>

<body class="bg-dark text-white">



        <div id="star-container"></div>



        <div id="main-content"
        class="container vh-100 d-flex flex-column justify-content-center align-items-center text-center">



                <h1 class="mb-3 display-4">Contador Estelar</h1>



                <div class="input-area input-group mb-3 justify-content-center">

                         <label for="targetTimeInput" class="col-form-label">Hora objetivo:</label>

                         <input type="time" id="targetTimeInput" class="form-control mx-2" required>

                         <button id="startButton" class="btn btn-primary">Iniciar Cuenta Regresiva</button>

                    </div>



                <div id="targetInfo" class="text-muted fst-italic mb-1" style="min-height: 1.2em;"></div>

                <div id="hoursElapsedDisplay" class="mt-1 mb-3 text-info fw-bold">Horas transcurridas: 0</div>



                <div id="timerDisplay" class="p-3 rounded bg-secondary shadow mb-4">00:00:00:000</div>



                <div class="face-container my-4">

                        <div id="faceDisplay" class="face">

                                <div id="mouth" class="mouth sad-mouth"></div>

                            </div>

                    </div>

            </div>



       
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>



       
    <script>

        const timerDisplay = document.getElementById('timerDisplay');

        const faceDisplay = document.getElementById('faceDisplay');

        const mouth = document.getElementById('mouth');

        const targetTimeInput = document.getElementById('targetTimeInput');

        const startButton = document.getElementById('startButton');

        const targetInfo = document.getElementById('targetInfo');

        const starContainer = document.getElementById('star-container');

        const hoursElapsedDisplay = document.getElementById('hoursElapsedDisplay');



        let timerInterval = null;

        let targetTimestamp = 0;

        let initialDurationMs = 0;

        let tenMinuteIntervalsMarked = 0;



        // --- Constants for Vibration ---

        const MIN_VIBRATION_DURATION = 0.05; // seconds (fastest vibration)

        const MAX_VIBRATION_DURATION = 0.6;  // seconds (slowest vibration at start)



        // --- Helper Functions (formatTime, setFaceState, addStars - unchanged) ---

        function formatTime(milliseconds) {

            if (milliseconds < 0) milliseconds = 0;

            let totalSeconds = Math.floor(milliseconds / 1000);

            let totalMinutes = Math.floor(totalSeconds / 60);

            let totalHours = Math.floor(totalMinutes / 60);

            let ms = String(Math.floor(milliseconds % 1000)).padStart(3, '0');

            let seconds = String(totalSeconds % 60).padStart(2, '0');

            let minutes = String(totalMinutes % 60).padStart(2, '0');

            let hours = String(totalHours).padStart(2, '0');

            return `${hours}:${minutes}:${seconds}:${ms}`;

        }



        function setFaceState(progressRatio) {

            progressRatio = Math.max(0, Math.min(1, progressRatio));

            const initialTotalHours = initialDurationMs / (1000 * 60 * 60);

            let currentHue = 0;



            if (initialTotalHours >= 1) {

                const effectiveProgress = initialDurationMs > 0 ? Math.max(0, (progressRatio * initialTotalHours - 0.5) / (initialTotalHours - 0.5)) : 0;

                currentHue = Math.min(120, 120 * Math.max(0, effectiveProgress));

            } else {

                currentHue = 0;

            }

            faceDisplay.style.setProperty('--face-hue', currentHue);



            if (initialTotalHours >= 1 && progressRatio >= 0.5) {

                mouth.className = 'mouth happy-mouth';

            } else {

                mouth.className = 'mouth sad-mouth';

            }

        }



        function addStars(count) {

            for (let i = 0; i < count; i++) {

                const star = document.createElement('div');

                star.classList.add('star');

                const sizeRoll = Math.random();

                if (sizeRoll > 0.9) star.classList.add('large');

                else if (sizeRoll > 0.6) star.classList.add('medium');

                star.style.top = Math.random() * 100 + '%';

                star.style.left = Math.random() * 100 + '%';

                star.style.animationDelay = Math.random() * 3 + 's';

                starContainer.appendChild(star);

            }

        }

        // --- Update Timer Loop ---

        function updateTimer() {

            const now = new Date().getTime();

            const remainingTime = targetTimestamp - now;

            const elapsedMs = initialDurationMs - remainingTime;



            // --- Stop Condition ---

            if (remainingTime <= 0) {

                clearInterval(timerInterval);

                timerDisplay.textContent = "00:00:00:000";

                faceDisplay.style.setProperty('--face-hue', 120);

                mouth.className = 'mouth happy-mouth';

                faceDisplay.classList.remove('vibrating'); // Stop vibration

                faceDisplay.style.animationDuration = '';



                const finalHoursElapsed = Math.floor(Math.max(0, initialDurationMs) / (1000 * 60 * 60));

                hoursElapsedDisplay.textContent = `Horas transcurridas: ${finalHoursElapsed}`;



                startButton.disabled = false;

                targetTimeInput.disabled = false;

                targetInfo.textContent = "¡Tiempo cumplido!";

                console.log("¡Cuenta regresiva terminada!");

                return;

            }



            // --- Update Display ---

            timerDisplay.textContent = formatTime(remainingTime);



            // --- Update Elapsed Hours Display ---

            const fullHoursElapsed = Math.floor(elapsedMs / (1000 * 60 * 60));

            hoursElapsedDisplay.textContent = `Horas transcurridas: ${fullHoursElapsed}`;



            // --- Calculate Progress ---

            let progress = 0;

            if (initialDurationMs > 0) {

                // Clamp progress between 0 and 1 to avoid issues

                progress = Math.max(0, Math.min(1, elapsedMs / initialDurationMs));

            }



            // --- Update Face Color/Mouth ---

            setFaceState(progress); // Pass the calculated progress



            // --- Add Stars (1 star per 10 minutes elapsed) ---

            const totalMinutesElapsed = Math.floor(elapsedMs / (1000 * 60));

            const currentTenMinuteIntervals = Math.floor(totalMinutesElapsed / 10);



            if (currentTenMinuteIntervals > tenMinuteIntervalsMarked && initialDurationMs > 0) {

                const newStarsToAdd = currentTenMinuteIntervals - tenMinuteIntervalsMarked;

                addStars(newStarsToAdd);

                tenMinuteIntervalsMarked = currentTenMinuteIntervals;

            }



            // --- Update Face Vibration (Proportional Intensity) ---

            if (initialDurationMs > 0) {

                // Calculate duration based on progress (inverse relationship)

                const durationRange = MAX_VIBRATION_DURATION - MIN_VIBRATION_DURATION;

                let vibrationDuration = MAX_VIBRATION_DURATION - (progress * durationRange);



                // Ensure duration stays within defined bounds

                vibrationDuration = Math.max(MIN_VIBRATION_DURATION, vibrationDuration);



                faceDisplay.classList.add('vibrating'); // Ensure class is added

                faceDisplay.style.animationDuration = `${vibrationDuration}s`;

            } else {

                // If timer isn't running (duration 0), remove vibration

                faceDisplay.classList.remove('vibrating');

                faceDisplay.style.animationDuration = '';

            }

        }



        // --- Start Button Logic ---

        startButton.addEventListener('click', () => {

            const timeValue = targetTimeInput.value;

            if (!timeValue) {

                alert("Por favor, selecciona una hora objetivo.");

                return;

            }

            if (timerInterval) { clearInterval(timerInterval); }



            const [hours, minutes] = timeValue.split(':').map(Number);

            const now = new Date();

            let targetDate = new Date();

            targetDate.setHours(hours, minutes, 0, 0);

            const currentTimestamp = now.getTime();

            let tempTargetTimestamp = targetDate.getTime();

            let targetDayString = "hoy";



            if (tempTargetTimestamp <= currentTimestamp) {

                targetDate.setDate(targetDate.getDate() + 1);

                tempTargetTimestamp = targetDate.getTime();

                targetDayString = "mañana";

            }



            targetTimestamp = tempTargetTimestamp;

            initialDurationMs = Math.max(0, targetTimestamp - currentTimestamp); // Ensure non-negative



            targetInfo.textContent = `Objetivo: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')} de ${targetDayString}.`;



            // --- Reset Visual State ---

            tenMinuteIntervalsMarked = 0;

            starContainer.innerHTML = '';

            faceDisplay.style.setProperty('--face-hue', 0);

            mouth.className = 'mouth sad-mouth';

            hoursElapsedDisplay.textContent = 'Horas transcurridas: 0';

            faceDisplay.classList.remove('vibrating'); // Reset vibration

            faceDisplay.style.animationDuration = '';



            // --- Initial Display & Start ---

            // Calculate initial progress (should be 0 or very close)

            const initialElapsed = Math.max(0, now.getTime() - currentTimestamp); // Time already passed if target was in past today before adjusting

            const initialProgress = initialDurationMs > 0 ? Math.max(0, Math.min(1, initialElapsed / initialDurationMs)) : 0;



            timerDisplay.textContent = formatTime(initialDurationMs);

            setFaceState(initialProgress); // Set initial face state based on initial progress



            startButton.disabled = true;

            targetTimeInput.disabled = true;



            if (initialDurationMs > 0) {

                // Set initial vibration state based on initial progress

                const initialDurationRange = MAX_VIBRATION_DURATION - MIN_VIBRATION_DURATION;

                let initialVibrationDuration = MAX_VIBRATION_DURATION - (initialProgress * initialDurationRange);

                initialVibrationDuration = Math.max(MIN_VIBRATION_DURATION, initialVibrationDuration);

                faceDisplay.classList.add('vibrating');

                faceDisplay.style.animationDuration = `${initialVibrationDuration}s`;



                // Update immediately once before interval starts for accuracy

                updateTimer();

                timerInterval = setInterval(updateTimer, 53);

            } else {

                updateTimer(); // Run once to show 0 time and final state (no vibration)

            }

        });



        // --- Initial Page Load State ---

        timerDisplay.textContent = formatTime(0);

        mouth.className = 'mouth sad-mouth';

        faceDisplay.style.setProperty('--face-hue', 0);

        starContainer.innerHTML = '';

        hoursElapsedDisplay.textContent = 'Horas transcurridas: 0';

        faceDisplay.classList.remove('vibrating');

        faceDisplay.style.animationDuration = '';



    </script>



</body>

</html>